!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=17)}([function(e,t){e.exports=require("redis")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("koa-helmet")},function(e,t){e.exports=require("koa-static")},function(e,t){e.exports=require("koa-combine-routers")},function(e,t){e.exports=require("svg-captcha")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("koa-body")},function(e,t){e.exports=require("koa-json")},function(e,t){e.exports=require("@koa/cors")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("koa-compress")},function(e,t,r){"use strict";var o=r(6),n=r.n(o),i=r(1),a=r.n(i),s=r(7),c=r.n(s),u=r(0),p=r.n(u),d=r(8);var l={host:"localhost",port:15001,password:"123456"};const f={host:l.host,port:l.port,password:l.password,detect_buffers:!0,retry_strategy:function(e){return e.error&&"ECONNREFUSED"===e.error.code?new Error("The server refused the connection"):e.total_retry_time>36e5?new Error("Retry time exhausted"):e.attempt>10?void 0:Math.min(100*e.attempt,3e3)}},m=Object(d.promisifyAll)(p.a.createClient(f));m.on("error",e=>{console.log("Redis clent errir:"+e)});var b=new class{constructor(){}async getCaptcha(e){const t=e.request.query;console.log(t);const r=c.a.create({size:4,ignoreChars:"0o1il",color:!0,noise:Math.floor(5*Math.random()),width:150,height:38});var o,n,i;o=t.sid,n=r.text,i=600,null!=n&&("string"==typeof n?"nudefinde"!==i?m.set(o,n,"EX",i,p.a.print):m.set(o,n,p.a.print):"object"==typeof n&&Object.keys(n).forEach(e=>{console.log(o,e,n[e]),m.hset(o,e,n[e],p.a.print)})),e.body={code:200,data:r.data}}};const x=new a.a;x.get("/getCaptcha",b.getCaptcha);var g=x,h=r(9),y=r.n(h);var v=async function(e){let t=y.a.createTransport({host:"smtp.qq.com",port:587,secure:!1,auth:{user:"imoocbrian@qq.com",pass:"rbkcbxwrurygjfca"}});return(await t.sendMail({from:'"认证邮件" <imoocbrian@qq.com>',to:e.email,subject:""!==e.user?`你好开发者，${e.user}！《慕课网前端全栈实践》注册码`:"《慕课网前端全栈实践》注册码",text:`您在《慕课网前端全栈实践》课程中注册，您的邀请码是${e.code},邀请码的过期时间: ${e.expire}`,html:`\n        <div style="border: 1px solid #dcdcdc;color: #676767;width: 600px; margin: 0 auto; padding-bottom: 50px;position: relative;">\n        <div style="height: 60px; background: #393d49; line-height: 60px; color: #58a36f; font-size: 18px;padding-left: 10px;">Imooc社区——欢迎来到官方社区</div>\n        <div style="padding: 25px">\n          <div>您好，${e.user}童鞋，重置链接有效时间30分钟，请在${e.expire}之前重置您的密码：</div>\n          <a href="http://www.imooc.com" style="padding: 10px 20px; color: #fff; background: #009e94; display: inline-block;margin: 15px 0;">立即重置密码</a>\n          <div style="padding: 5px; background: #f2f2f2;">如果该邮件不是由你本人操作，请勿进行激活！否则你的邮箱将会被他人绑定。</div>\n        </div>\n        <div style="background: #fafafa; color: #b4b4b4;text-align: center; line-height: 45px; height: 45px; position: absolute; left: 0; bottom: 0;width: 100%;">系统邮件，请勿直接回复</div>\n    </div>\n    `})).messageId},q=r(10),w=r.n(q);var k=new class{constructor(){}async forget(e){const{body:t}=e.request;console.log(t);try{let r=await v({code:"1234",expire:w()().add(30,"minutes").format("YYYY-MM-DD HH:mm:ss"),email:t.username,user:"Brian"});e.body={code:200,data:r,msg:"邮件发送成功"}}catch(e){console.log(e)}}};const j=new a.a;j.post("/forget",k.forget);var O=j;t.a=n()(g,O)},function(e,t,r){"use strict";r.r(t),function(e){var t=r(2),o=r.n(t),n=r(3),i=r.n(n),a=r(4),s=r.n(a),c=r(5),u=r.n(c),p=r(16),d=r(11),l=r.n(d),f=r(12),m=r.n(f),b=r(13),x=r.n(b),g=r(14),h=r.n(g),y=r(15),v=r.n(y);const q=new o.a,w=h()([l()(),u()(i.a.join(e,"../public")),x()(),m()({pretty:!1,param:"pretty"}),s()()]);q.use(v()()),q.use(w),q.use(Object(p.a)()),q.listen(3e3)}.call(this,"src")}]);